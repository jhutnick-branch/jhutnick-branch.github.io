<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- <meta property="og:description" content="some content here"/> -->
<meta name="branch:deeplink:~campaign" content="testScrapeOrgCampaign" />
<meta name="branch:deeplink:~channel" content="testScrapeOrgChannel" />
<!--<meta name="branch:deeplink:productId" content="1234" /> -->
<!-- <meta name="branch:deeplink:page_type" content="Merchant Page" /> -->
<meta name="branch:deeplink:$deeplink_path" content="/test/org" />
	
<!-- <meta name="branch:deeplink:name" content="jonathan_hutnick" /> -->
<!-- <meta name="branch:deeplink:liquidValue" content="Liquid App" /> -->
<!-- <meta name="branch:deeplink:liquidTitle" content="Visit now for 10% off" /> -->

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script type="text/javascript">
// Load Branch
(function(b,r,a,n,c,h,_,s,d,k){if(!b[n]||!b[n]._q){for(;s<_.length;)c(h,_[s++]);d=r.createElement(a);d.async=1;d.src="https://cdn.branch.io/branch-latest.min.js";k=r.getElementsByTagName(a)[0];k.parentNode.insertBefore(d,k);b[n]=h}})(window,document,"script","branch",function(b,r){b[r]=function(){b._q.push([r,arguments])}},{_q:[],_v:1},"addListener banner closeBanner closeJourney data deepview deepviewCta first init link logout removeListener setBranchViewData setIdentity track trackCommerceEvent logEvent disableTracking getBrowserFingerprintId crossPlatformIds lastAttributedTouchData setAPIResponseCallback qrCode setRequestMetaData setAPIUrl getAPIUrl setDMAParamsForEEA".split(" "), 0);
branch.setRequestMetaData("$marketing_cloud_visitor_id","12345");
	// Assuming your URL is in a variable called myDynamicImage
branch.init('key_live_dm2I4K0XC9OUncuFN2BMilagzsbIY0Qo');

// // 1. Grab your dynamic image URL
// var url_for_image = "https://cdn.branch.io/branch-assets/journeys/892511430966793060/interstitial-BranchJourney-Station-1125x2000-2-1666370851953.jpg";

// // 2. We have to wait for the iframe to actually be created by Branch
// var checkIframe = setInterval(function() {
//     // Branch usually gives the iframe an ID like 'branch-banner-iframe' 
//     // or it's inside a div with id 'branch-banner'
//     var iframe = document.querySelector('iframe#branch-banner-iframe') || document.querySelector('.branch-journey-container iframe');

//     if (iframe) {
//         clearInterval(checkIframe); // Stop looking once we find it

//         iframe.onload = function() {
//             try {
//                 var style = document.createElement('style');
//                 style.textContent = `
//                     #branch-banner .branch-banner-content {
//                         background-image: url('${url_for_image}') !important;
//                     }
//                 `;
//                 iframe.contentDocument.head.appendChild(style);
//                 console.log("CSS Injected Successfully");
//             } catch (e) {
//                 console.error("Security Block: Cannot access iframe content.", e);
//             }
//         };
//     }
// }, 500); // Check every 500ms
//branch.setBranchViewData({
//    data: {
//        'custom_bg': "https://cdn.branch.io/branch-assets/journeys/892511430966793060/interstitial-BranchJourney-Station-1125x2000-2-1666370851953.jpg"
//    }
//});

//branch.closeJourney(function(err, data) {
//   console.log(err, data);
//});

// reopen
//branch.track("pageview");

//branch.setBranchViewData({data: {'$journeys_title': 'Visit now for 20% off',}});

//branch.closeJourney(function(err, data) {
//	console.log(err, data);
//});


//var linkData = {
//  alias: '',
 // data: {
//    'custom_bool': true,
 //   'custom_int': Date.now(),
 //   'custom_string': 'hello',
 //   '$og_title': 'Title',
 //   '$og_description': 'orgtest',
  //  '$og_image_url':'http://lorempixel.com/400/400',
  //  '$original_url': 'https://www.depop.com/gb/',
  //  '$desktop_deepview': 'branch_default',
 //   '$canonical_url': 'https://www.depop.com/gb/'
//  }
//};

//branch.link(linkData, function(err, link) {
//  console.log(link);
//});

	
//branch.init('key_live_dm2I4K0XC9OUncuFN2BMilagzsbIY0Qo', function(err, data) {
//  console.log(err, data);
//});

// branch.data(function(err, data) {
//   console.log(err, data);
// });

// optional additional deep link data
// var linkData = {
//   campaign: 'content 123',
//   channel: 'facebook',
//   feature: 'dashboard',
//   stage: 'new user',
//   tags: [ 'tag1', 'tag2', 'tag3' ],
//   alias: '',
//   data: {
//     'custom_bool': true,
//     'custom_int': Date.now(),
//     'custom_string': 'hello',
//     '$og_title': 'Title',
//     '$og_description': 'Description',
//     '$og_image_url':'http://lorempixel.com/400/400',
//     '$journeys_title': 'Mi App',    
//     '$journeys_description': 'Mi descripciÃ³n', 
//     '$journeys_button_get_has_app"': 'Abrir', 
//     '$journeys_button_get_no_app': 'Ver' 
//   }
// };

// branch.setBranchViewData(linkData);
// branch.setBranchViewData({
//     data: {
//         'liquidValue': 'LiquidApp',
//         'liquidName': 'Jon',    
//     }
// });
	
// branch.closeJourney(function(err, data) {
//   console.log(err, data);
// });

// // reopen
// branch.track("pageview");

  function purchaseEvent () {
    console.log("purchase");
    var commerce_data = {"revenue":28.45,
      "currency":"USD",
      "transaction_id":"313299",
      "shipping":5.95,
      "tax":0,
      //"~referring_link":"379998049730159899",
      "products":[{"sku":"xbar1788","name":"SAFTB Golf Towel - GOLF / SAFTB","price":25,"quantity":1,"category":"","variant":"GOLF / SAFTB"}]
    };
    var metadata =  {};
    branch.trackCommerceEvent('purchase', commerce_data, metadata, function(err) {
        if(err) {
             throw err;
        }
    });
  };

  function registerEvent () {
    console.log("register");
    var register_data = {
      "transaction_id": "tras_Id_1234",
      "description": "Registered",
      "registration_id": "12345"
    };
    var customer_event_alias = "my custom alias";
    branch.logEvent("COMPLETE_REGISTRATION", register_data, customer_event_alias, function(err) { 
      console.log(err); 
      });
  };

  function viewEvent () {
    console.log("view item");
// reopen
    branch.track("pageview");
    var register_data = {
      "transaction_id": "tras_Id_1234",
      "description": "Registered",
      "registration_id": "12345"
    };
    var customer_event_alias = "my custom alias";
    branch.logEvent("VIEW_ITEM", register_data, customer_event_alias, function(err) { 
      console.log(err); 
      });
  };

  function customEvent () {
    console.log("custom event");
    var custom_data = {
      "Custom_Event_Property_Key1": "Custom_Event_Property_val1",
      "Custom_Event_Property_Key2": "Custom_Event_Property_val2"
    };
    branch.logEvent('test_custom_event',custom_data, function(err) { 
      console.log(err); }
    );
  };

  function addEvent () {
    console.log("add to cart");
    var commerce_data = {"revenue":28.45,
      "currency":"USD",
      "transaction_id":"313299",
      "shipping":5.95,
      "tax":0,
      //"~referring_link":"379998049730159899",
      "products":[{"sku":"xbar1788","name":"SAFTB Golf Towel - GOLF / SAFTB","price":25,"quantity":1,"category":"","variant":"GOLF / SAFTB"}]
    };
    var customer_event_alias = "my custom alias";
    branch.logEvent("ADD_TO_CART", commerce_data, customer_event_alias, function(err) { 
      console.log(err); 
      });
  };

  function makeLink () {
    var canonicalURL = window.location.href;
    var linkData = {
      "$canonical_url": canonicalURL,
      "campaign":"TTSite"
    };

    branch.link(linkData, function(err, link) {
                if (err == null) {
                    document.getElementById('generatedLink').value = link;
                } else {
                    document.getElementById('generatedLink').value = err;
                }
            });
  }
</script>
<title>Example Site</title>


<link rel="stylesheet" type="text/css" href="css/bootstrap-theme.min.css">
<link href="css/bootstrap.css" rel="stylesheet">

</head>

<body>

	<div class="container">

      <div class="row col-lg-8 col-lg-offset-2">
      <h2>Test Site</h2>
    </div>
    <section>
      <div class="row col-lg-8 col-lg-offset-2">
        <div class="group">
         <h4>Register</h4>
          <button class="btn btn-info" onclick="registerEvent()">Register</button>
        </div>
      </div>
      <div class="row col-lg-8 col-lg-offset-2">
        <div class="group">
         <h4>View Item</h4>
          <button class="btn btn-info" onclick="viewEvent()">View Item</button>
        </div>
      </div>
      <div class="row col-lg-8 col-lg-offset-2">
        <div class="group">
         <h4>Add To Cart</h4>
          <button class="btn btn-info" onclick="addEvent()">Add To Cart</button>
        </div>
      </div>
      <div class="row col-lg-8 col-lg-offset-2">
        <div class="group">
         <h4>Purchase</h4>
          <button class="btn btn-info" onclick="purchaseEvent()">Purchase</button>
        </div>
      </div>
      <div class="row col-lg-8 col-lg-offset-2">
        <div class="group">
         <h4>Custom Event</h4>
          <button class="btn btn-info" onclick="customEvent()">Custom Event</button>
        </div>
      </div>
      <div class="row col-lg-8 col-lg-offset-2">
        <div class="group">
         <h4>Make a Link</h4>
          <button class="btn btn-info" onclick="makeLink()">Link</button>
        </div>
        <br>
        <textarea class="form-control" style="height:40px; margin-bottom:5%;" id="generatedLink" type="text"></textarea>
      </div>
	<div class="row col-lg-8 col-lg-offset-2">
	  <div class="group">
	    <h4>Test Link</h4>
	     <p><a href="https://xhmm.app.link/biem7QzclCb?web_anonymous_id=a261c609-4561-4fb2-98c5-ffdd5ec3c0fc&action=target-circle-360">Test Link!</a></p>
	   </div>
	   <br>
      </div>
      </section>
  </div>

 </body>
 </html>
